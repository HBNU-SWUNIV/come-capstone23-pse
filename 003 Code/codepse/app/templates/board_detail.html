<!DOCTYPE html>
<html>
<head>
    <title>board_detail</title>
    <link href="{{ url_for('static', filename='css/board_detail.css') }}" rel="stylesheet">
</head>

<body>
    <div class="post-details"> 
        <!-- 임의 게시글 -->
        <h2 class="post-title">피카츄 라이츄</h2>
        <div class="post-info">
            <p>작성자: 파이리 | 날짜: 2023.7.25 | 조회수: 3</p>
        </div>
        <div class="post-content">
            <pre>우리는 모두 친구
피카츄 라이츄 파이리 꼬부기
버터플 야도란 피죤투 또가스
서로 생긴 모습은 달라도 우리는 모두 친구 (맞아)
               
산에서 들에서 때리고 뒹굴고
사막에서 정글에서 울다가 웃다가
서로 만나기까지 힘들었어도 우리는 모두 친구 (피카피카)
            </pre>
        </div>

        <!-- 댓글 작성 폼 -->
        <div class="comment-form-wrapper">
            <form class="comment-form">
                <div class="comment-form-input"> <!-- 버튼 위치 -->
                    <textarea name="comment" placeholder="댓글을 작성하세요..."></textarea>
                    <button type="submit">댓글 작성</button>
                </div>
            </form>
        </div>

        <!-- 댓글 목록 / 동적 생성 댓글 -->
        <div class="comment-list-wrapper">
            <div class="comment">
                <div class="comment-info-wrapper">
                    <p class="comment-info">작성자: 피카츄 | 날짜: 2023.7.25</p>
                </div>
                <div class="comment-content-wrapper">
                    <p class="comment-content">1빠</p>
                    <div class="buttons-wrapper">
                        <button class="edit-btn">수정</button>
                        <button class="delete-btn">삭제</button>
                    </div>
                </div>
            </div>

            <div class="comment">
                <div class="comment-info-wrapper">
                    <p class="comment-info">작성자: 피존투 | 날짜: 2023.7.26</p>
                </div>
                <div class="comment-content-wrapper">
                    <p class="comment-content">피존 앤 다우니</p>
                    <div class="buttons-wrapper">
                        <button class="edit-btn">수정</button>
                        <button class="delete-btn">삭제</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 댓글 추가 (자바스크립트) -->
    <script>
        const commentForm = document.querySelector('.comment-form');
        const commentListWrapper = document.querySelector('.comment-list-wrapper');

        commentForm.addEventListener('submit', function (event) {
            event.preventDefault(); // 페이지 이동 막음

            // 댓글 내용 가져오기
            const commentText = commentForm.querySelector('textarea').value;

            // 현재 날짜 생성
            const currentDate = new Date();
            const formattedDate = `${currentDate.getFullYear()}.${currentDate.getMonth() + 1}.${currentDate.getDate()}`;

            // 댓글 생성
            const newComment = document.createElement('div');
            newComment.classList.add('comment');
            newComment.innerHTML = `
                <div class="comment-info-wrapper">
                    <p class="comment-info">작성자: 사용자 | 날짜: ${formattedDate}</p>
                </div>
                <div class="comment-content-wrapper">
                    <p class="comment-content">${commentText}</p>
                    <div class="buttons-wrapper">
                        <button class="edit-btn">수정</button>
                        <button class="delete-btn">삭제</button>
                    </div>
                </div>
            `;

            // 댓글 목록에 댓글 추가
            commentListWrapper.appendChild(newComment);

            // 댓글작성폼 내용 지움
            commentForm.querySelector('textarea').value = '';
        });

        // 댓글 수정 기능
        commentListWrapper.addEventListener('click', function (event) {
            const target = event.target;
            if (target.classList.contains('edit-btn')) {
                const comment = target.closest('.comment');
                const commentContent = comment.querySelector('.comment-content');
                const originalContent = commentContent.textContent; // 사용자가 수정을 취소할 때 원래 댓글의 내용을 복구하기 위해 사용
                const commentText = commentContent.textContent; // 수정 폼의 텍스트 영역에 원래 내용을 초기화하기 위해 사용

                // 작성자와 날짜 가져오기
                const commentInfo = comment.querySelector('.comment-info').textContent;
                const datePattern = /날짜: (\d{4}\.\d{1,2}\.\d{1,2})/; // 날짜 정보를 추출하는 정규표현식

                // 현재 날짜 추출
                let currentDateString = datePattern.exec(commentInfo)[1];

                // 수정 입력 폼 생성
                const editForm = document.createElement('form');
                editForm.classList.add('edit-form');
                editForm.innerHTML = `
                    <p class="comment-info">${commentInfo}</p>
                    <textarea name="edit-comment">${commentText}</textarea>
                    <button type="submit">완료</button>
                    <button type="button" class="cancel-btn">취소</button>
                `;

                // 기존 내용 감추기 및 버튼 숨기기
                commentContent.style.display = 'none';
                comment.querySelector('.buttons-wrapper').style.display = 'none';

                // 수정 폼 삽입
                comment.insertBefore(editForm, comment.querySelector('.comment-info-wrapper'));

                // 작성자와 날짜가 위에 나타나도록 수정
                comment.querySelector('.comment-info-wrapper').style.display = 'none';

                // 수정 완료 버튼 클릭 시
                editForm.addEventListener('submit', function (event) {
                    event.preventDefault();

                    // 새로운 내용으로 댓글 수정
                    const newContent = editForm.querySelector('textarea').value;
                    commentContent.textContent = newContent;

                    // 수정 입력 폼 제거 및 기존 내용/버튼 보이게
                    commentContent.style.display = 'block';
                    comment.querySelector('.buttons-wrapper').style.display = 'block';
                    comment.querySelector('.comment-info-wrapper').style.display = 'flex';

                    comment.removeChild(editForm);
                });

                // 취소 버튼 클릭 시
                const cancelBtn = editForm.querySelector('.cancel-btn');
                cancelBtn.addEventListener('click', function () {
                    // 수정 취소하고 원래 내용으로 복구
                    commentContent.textContent = originalContent;

                    // 수정 입력 폼 제거 및 기존 내용/버튼 보이게
                    commentContent.style.display = 'block';
                    comment.querySelector('.buttons-wrapper').style.display = 'block';
                    comment.querySelector('.comment-info-wrapper').style.display = 'flex';

                    comment.removeChild(editForm);
                });
            }
        });
    </script>
</body>
</html>